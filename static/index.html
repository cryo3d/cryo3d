<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

  	<!-- External JS Files -->
  	<script src="../Build/Cesium/Cesium.js"></script>

  	<!-- External CSS Files -->
	<link rel="stylesheet" type="text/css" href="CSS/menubar.css">

	<title>Welcome to Cryo3D!</title>
 
</head>

<body>
	<div id="cesiumContainer"></div>
  
  	<!-- TO DO: MAKE JS EXTERNAL 
    making some of the scripts external may break other scripts that
	rely on them being loaded first-->     
  	<script src="Data/FlightPaths.jsonp"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script> <!-- allows us to call php scripts !-->
	<script type="text/javascript">
		var extent = Cesium.Rectangle.fromDegrees(-99.240573,41.808406,20.313421,86.468825);
    	Cesium.Camera.DEFAULT_VIEW_RECTANGLE = extent;
    	Cesium.Camera.DEFAULT_VIEW_FACTOR = 0;
		var viewer = new Cesium.Viewer('cesiumContainer', {
		animation : false,
		timeline : false,
		});
		
		/* Allows us to run our own custom scripts */
		viewer.infoBox.frame.removeAttribute('sandbox');

		/* Connect 2 waypoints on map and draw a line */
		function drawFlightPath(waypoints){
			var points = [];
			for (var i = 0; i < waypoints.length; i++){
				points.push(waypoints[i][0]);
				points.push(waypoints[i][1]);
			}		
			var redLine = viewer.entities.add({
			    name : 'Red line on the surface',
			    polyline : {
			        positions : Cesium.Cartesian3.fromDegreesArray(points),
			        width : 3,
			        material : Cesium.Color.YELLOW
			    }
			});
			return redLine;
		}	

		/* Reads flightpath info from json and populates globe with waypoints and flightpaths */
		/* TO DO: instead of displaying all of them on the globe at once, have dropdown list of
		tours to choose from and display specific flight path when selected */
		var pinCount = 0;
		var lastPinLat = 0;
		var lastPinLong = 0;
		function loadFlightPaths(){
		    var x = 0;
		    var flightPaths=jsonstr;
	        var flightPathData = flightPaths[0];
	        for(var tourName in flightPathData){
	            var tourNameObj = flightPathData[tourName];
	            pinCount = 0;
	        	for(var pinName in tourNameObj){
	        		var pinObj = tourNameObj[pinName];
			        var latitude = pinObj["latitude"];
			        var longitude = pinObj["longitude"];
			        var description = pinObj["description"];

					var pinBuilder = new Cesium.PinBuilder();
			    	var pin = viewer.entities.add({
			      	name : pinName,
			      	position : Cesium.Cartesian3.fromDegrees(longitude, latitude),
			      	billboard : {
			        image : pinBuilder.fromColor(Cesium.Color.CORNFLOWERBLUE, 36).toDataURL(),
			        verticalOrigin : Cesium.VerticalOrigin.BOTTOM
			      	} 	
			    	});
			      	pin.description = description;

			      	if (pinCount != 0){
			      		drawFlightPath([[lastPinLong, lastPinLat], [longitude, latitude]]);
			      	}
			      	lastPinLat = latitude;
			      	lastPinLong = longitude;
			      	pinCount++;
	        	}
	        }
		}

	  loadFlightPaths();
	</script>

  	<div id="menuButton">
		<button class="menuButton" onclick="menuBarToggle()" onmouseover="menuHover()">Cryo3D Menu</button>
		<!-- Attempt at text showing upon hover -->
		<!-- <p id="menuHoverText" style="display:inline; color: white"></p> -->
  	</div>

  	<div id="adminButton">
  		<button class="adminLoginButton" onclick="adminLoginToggle()">Admin? Login Here!</button>
  	</div>

  	<div id="menuBar">
		<ul>
	  		<li> <a class="active" href="#home">Home</a></li>   
	  		<!-- TO DO: Have way to add waypoints by making GET requests with PHP and
	  		append to the FlightPaths.jsonp file -->
	  		<li> <a id="waypoints" href="#">Waypoints</a></li>
	  		<li> <a id="flightpaths" href="#">Flight Paths</a></li>
		</ul>
  	</div>

  	<div id="openModal" class="modalDialog" style="display:none">
  		<h2>Admin Login</h2>
  		<p>This is a test paragraph</p>
  		<button onclick="adminLoginToggle()" style="position:absolute; bottom: 10px; right: 10px">Cancel</button>
  	</div>

  	<div id="flightPathModal" class="modalDialog" style="display:none">
  		<h2>Edit existing flight path</h2>
  		<p>Here you can update or delete an existing flight path</p>
  		<!-- Have dropdown list be populated by SQL query-->
  		<select>
		  <option value="1">Alaska</option>
		  <option value="2">Greenland</option>
		</select>

		<h2>Create new flight path</h2>
  		<p>Here you can add a new flight path</p>
  		<!-- Have dropdown list be populated by SQL query-->
  		<form>
  			Tour Name:&nbsp
  			<input type="text"></input>
  		<form>

  		<button onclick="flightPathModalToggle()" style="position:absolute; bottom: 10px; right: 10px">Cancel</button>
  	</div>  	

  	<!-- TO DO: Make one general toggle function -->
  	<script type="text/javascript">  
		function menuBarToggle() {  
	  		var e = document.getElementById("menuBar");
	  		if(e.style.display == 'block')
				e.style.display = 'none';
	  		else
				e.style.display = 'block';
		}

		function adminLoginToggle() {
			var e = document.getElementById("openModal");
	  		if(e.style.display == 'none')
				e.style.display = 'block';
	  		else
				e.style.display = 'none';
		}

		function flightPathModalToggle() {
			var e = document.getElementById("flightPathModal");
	  		if(e.style.display == 'none')
				e.style.display = 'block';
	  		else
				e.style.display = 'none';
		}	

		function initDatabase(){
		    $.ajax({
			    url: 'PHP/initDatabase.php',
			    error: function (xhr, status, error) {
			        // executed if something went wrong during call
			        if (xhr.status > 0) alert('got error: ' + status); // status 0 - when load is interrupted
			    },
			    success: function() {
               		 //alert("No errors");
               	}
			});			
		}	

		initDatabase(); //makes ajax call to php script that initializes the database
		
		var e2 = document.getElementById('flightpaths');
		e2.onclick = flightPathModalToggle;

		function addFlightPath(){
		    $.ajax({
			    url: 'PHP/addFlightPath.php',
			    error: function (xhr, status, error) {
			        // executed if something went wrong during call
			        if (xhr.status > 0) alert('got error: ' + status); // status 0 - when load is interrupted
			    },
			    success: function() {
               		 //alert("No errors");
               	}
			});
		}

		/*
		function menuHover() {
			document.getElementById("menuHoverText").innerHTML="Click to toggle Menu";
		}
		*/
  	</script>  

</body>

</html>